apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/name: "go-fiber"
    app.kubernetes.io/part-of: "credstack"
    app.kubernetes.io/component: "api"
    app.kubernetes.io/version: {{ .Chart.AppVersion }}
  name: credstack-api
spec:
  replicas: {{ .Values.deployment.replicas }}
  selector:
    matchLabels:
      app.kubernetes.io/name: "go-fiber"
      app.kubernetes.io/part-of: "credstack"
      app.kubernetes.io/component: "api"
      app.kubernetes.io/version: {{ .Chart.AppVersion }}
  strategy: {}
  template:
    metadata:
      labels:
        app.kubernetes.io/name: "go-fiber"
        app.kubernetes.io/part-of: "credstack"
        app.kubernetes.io/component: "api"
        app.kubernetes.io/version: {{ .Chart.AppVersion }}
    spec:
      tolerations: {{ .Values.deployment.tolerations }}
      containers:
      - image: {{ .Values.deployment.image.name }}:{{ .Chart.AppVersion }}
        name: credstack-api
        ports:
          - name: http
            containerPort: 8080
        envFrom:
          - configMapRef:
              name: {{ .Release.Name }}-cm
          - secretRef:
              name: {{ .Release.Name}}-secret
        resources:
          requests:
            cpu: {{ .Values.deployment.resources.requests.cpu }}
            memory: {{ .Values.deployment.resources.requests.memory }}
          limits:
            cpu: {{ .Values.deployment.resources.limits.cpu }}
            memory: {{ .Values.deployment.resources.limits.memory }}